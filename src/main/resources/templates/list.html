<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Housekeeping</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/styles.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>
<body class="p-4">
<h2>Student Housekeeping</h2>

<form method="get" class="d-flex mb-3">
    <input type="text" name="q" class="form-control me-2"
           placeholder="Search name or room..." th:value="${query}">
    <button class="btn btn-primary me-2">Search</button>
    <a href="/students" class="btn btn-secondary">Clear</a>
</form>

<a href="/students/new" class="btn btn-success mb-3">+ New Student</a>

<table class="table table-bordered">
    <thead>
    <tr>
        <th>ID</th><th>Name</th><th>Room</th><th>Phone</th><th>Check-In</th><th>Cleanliness</th>
        <th>Remarks</th><th>Action</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="s : ${students}">
        <td th:text="${s.id}"></td>
        <td th:text="${s.name}"></td>
        <td th:text="${s.roomNo}"></td>
        <td th:text="${s.phoneNo}"></td>
        <td th:text="${s.checkInDate}"></td>
        <td th:with="
  raw=${s.cleanlinessScore ?: 0},
  score=${raw > 5 ? T(java.lang.Math).round(raw / 20.0) : raw},
  s5=${T(java.lang.Math).min(5, T(java.lang.Math).max(0, score))}
">
            <span th:each="i : ${#numbers.sequence(1, s5)}">&#9733;</span>
            <span th:each="i : ${#numbers.sequence(s5 + 1, 5)}">&#9734;</span>
        </td>



        <td th:text="${s.remarks}"></td>
        <td>
            <a th:href="@{'/students/' + ${s.id} + '/edit'}" class="btn btn-warning btn-sm">Edit</a>
            <form th:action="@{'/students/' + ${s.id} + '/delete'}" method="post" style="display:inline">
                <button class="btn btn-danger btn-sm">Delete</button>
            </form>
        </td>
    </tr>
    </tbody>
</table>

<script>
    // Bonus: live filter with jQuery
    $("input[name='q']").on("input", function() {
        const val = $(this).val().toLowerCase();
        $("tbody tr").each(function() {
            $(this).toggle($(this).text().toLowerCase().includes(val));
        });
    });
</script>
</body>
</html>
